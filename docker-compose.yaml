# DNAT - Main Docker Compose
#
# This is the main orchestration file for local development.
# It runs the blockchain (Hardhat) and client.
#
# The Executor + IPFS run on a separate VM and are accessed via SSH tunnel.
#
# Setup:
# 1. Start this on your local machine: docker compose up
# 2. Start executor on VM: cd executor && docker compose up
# 3. SSH tunnel from local to VM:
#    ssh -L 8080:localhost:8080 -L 5001:localhost:5001 -L 8081:localhost:8081 -L 8545:localhost:8545 user@vm

services:
  # ===========================================
  # Client - Next.js Frontend
  # ===========================================
  client:
    image: node:20.19.5
    container_name: dnat-client
    working_dir: /app
    ports:
      - "3000:3000"
    volumes:
      - ./client:/app
      - /app/node_modules
    environment:
      # Executor API via SSH tunnel
      NEXT_PUBLIC_EXECUTOR_URL: "http://localhost:8081"
    command: ["sh", "-c", "npm install && npm run dev"]